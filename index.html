<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TikTok Hook Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f0f0f;
      color: #ffffff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 24px;
    }
    .app {
      width: 100%;
      max-width: 520px;
      padding: 24px;
      background: #151515;
      border-radius: 12px;
      box-shadow: 0 0 40px rgba(0,0,0,0.6);
    }
    h1 { font-size: 24px; margin: 0 0 12px; }

    .desc {
      margin: 0 0 14px;
      font-size: 14px;
      line-height: 1.5;
      color: #cccccc;
    }

    .examples {
      margin: 0 0 16px;
      font-size: 13px;
      line-height: 1.5;
      color: #b5b5b5;
    }

    .meta {
      margin: 0 0 10px;
      font-size: 12px;
      color: #9a9a9a;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
    }

    textarea {
      width: 100%;
      height: 70px;
      background: #0f0f0f;
      color: #fff;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 10px;
      resize: none;
      font-size: 14px;
      outline: none;
    }
    button {
      margin-top: 12px;
      width: 100%;
      padding: 12px;
      background: #ffffff;
      color: #000;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }
    button:disabled { opacity: 0.6; cursor: not-allowed; }

    .upgrade {
      margin-top: 10px;
      background: #2a2a2a;
      color: #fff;
    }

    .hooks { margin-top: 20px; }
    .hook {
      background: #0f0f0f;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 14px;
      border: 1px solid #222;
    }

    .copy {
      margin-top: 10px;
      background: #2a2a2a;
      color: #fff;
    }

    .status {
      margin-top: 10px;
      font-size: 13px;
      opacity: 0.9;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .status.error { color: #ff6b6b; }
    .status.ok { color: #b6ffb6; }
  </style>
</head>
<body>
  <div class="app">
    <h1>TikTok Hook Generator</h1>

    <p class="desc">
      TikTok hooks decide whether people watch or scroll.
      Enter your video topic and get <b>10 high-converting hooks</b>
      designed to grab attention in the first 3 seconds.
      <br><br>
      Perfect for creators, coaches, marketers, and anyone posting daily content.
      <br><br>
      <b>Why this tool works better than others:</b><br>
      • Built specifically for TikTok hooks — not generic AI text<br>
      • Gives multiple hook angles in one click<br>
      • No prompts, no setup, no thinking — just results
    </p>

    <p class="examples">
      <b>What to enter:</b><br>
      Enter a short video topic — not a script and not a question.
      Just describe what your video is about in a few words.
      <br><br>
      <b>Examples:</b><br>
      • how to get clients<br>
      • why your videos get no views<br>
      • how to grow on TikTok<br>
      • common fitness mistakes<br>
      • habits that ruin your focus
    </p>

    <div class="meta">
      <div id="limitText">Free trial: 2 generations</div>
      <div id="counterText">Remaining: —</div>
    </div>

    <textarea id="topic" placeholder="Enter video topic..."></textarea>
    <button id="genBtn" onclick="generateHooks()">Generate hooks</button>

    <div class="status" id="status"></div>
    <div class="hooks" id="hooks"></div>

    <button class="copy" onclick="copyHooks()">Copy all hooks</button>
    <button class="upgrade" id="upgradeBtn" style="display:none;" onclick="upgrade()">Upgrade (Unlimited)</button>
  </div>

  <script>
    const FREE_LIMIT_TOTAL = 2;
    const STORAGE_KEY = "tth_free_total_v1";

    function getUsed() {
      return Number(localStorage.getItem(STORAGE_KEY) || 0);
    }

    function setUsed(n) {
      localStorage.setItem(STORAGE_KEY, String(n));
    }

    function remaining() {
      const used = getUsed();
      const rem = Math.max(0, FREE_LIMIT_TOTAL - used);
      return { used, rem };
    }

    function updateCounterUI() {
      const { rem } = remaining();
      document.getElementById("counterText").textContent = `Remaining: ${rem}`;
      document.getElementById("upgradeBtn").style.display = rem === 0 ? "block" : "none";
    }

    function renderHooks(hooks) {
      const container = document.getElementById("hooks");
      container.innerHTML = "";
      hooks.forEach(h => {
        const div = document.createElement("div");
        div.className = "hook";
        div.textContent = h;
        container.appendChild(div);
      });
    }

    function upgrade() {
      alert("Payment coming next. This will unlock unlimited access.");
    }

    async function generateHooks() {
      const topic = document.getElementById("topic").value.trim();
      const status = document.getElementById("status");
      const btn = document.getElementById("genBtn");

      status.className = "status";
      status.textContent = "";
      renderHooks([]);

      if (!topic) {
        status.className = "status error";
        status.textContent = "Please enter a topic.";
        return;
      }

      const u = remaining();
      if (u.rem <= 0) {
        status.className = "status error";
        status.textContent =
          "Free trial used.\nUpgrade to unlock unlimited generations.";
        updateCounterUI();
        return;
      }

      btn.disabled = true;
      status.textContent = "Generating…";

      try {
        const resp = await fetch("/api/hooks", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ topic })
        });

        const data = await resp.json().catch(() => ({}));

        if (!resp.ok) {
          status.className = "status error";
          status.textContent =
            "API ERROR\n" +
            (data.error ? data.error : "Unknown error");
          return;
        }

        const hooks = Array.isArray(data.hooks) ? data.hooks : [];
        if (!hooks.length) {
          status.className = "status error";
          status.textContent = "No hooks returned.";
          return;
        }

        setUsed(getUsed() + 1);
        updateCounterUI();

        status.className = "status ok";
        status.textContent = "Done.";
        renderHooks(hooks);

      } catch (e) {
        status.className = "status error";
        status.textContent = "NETWORK ERROR\n" + String(e);
      } finally {
        btn.disabled = false;
      }
    }

    async function copyHooks() {
      const hooks = document.querySelectorAll(".hook");
      if (!hooks.length) return alert("Nothing to copy.");
      let text = "";
      hooks.forEach(h => text += h.textContent + "\n");
      await navigator.clipboard.writeText(text);
      alert("Hooks copied");
    }

    updateCounterUI();
  </script>
</body>
</html>
