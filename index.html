<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TikTok Hook Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f0f0f;
      color: #ffffff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 24px;
    }
    .app {
      width: 100%;
      max-width: 520px;
      padding: 24px;
      background: #151515;
      border-radius: 12px;
      box-shadow: 0 0 40px rgba(0,0,0,0.6);
    }
    h1 { font-size: 24px; margin: 0 0 12px; }

    .desc {
      margin: 0 0 14px;
      font-size: 14px;
      line-height: 1.5;
      color: #cccccc;
    }

    .examples {
      margin: 0 0 16px;
      font-size: 13px;
      line-height: 1.5;
      color: #b5b5b5;
    }

    .meta {
      margin: 0 0 10px;
      font-size: 12px;
      color: #9a9a9a;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
    }

    textarea {
      width: 100%;
      height: 70px;
      background: #0f0f0f;
      color: #fff;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 10px;
      resize: none;
      font-size: 14px;
      outline: none;
    }
    button {
      margin-top: 12px;
      width: 100%;
      padding: 12px;
      background: #ffffff;
      color: #000;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }
    button:disabled { opacity: 0.6; cursor: not-allowed; }

    .upgrade {
      margin-top: 10px;
      background: #2a2a2a;
      color: #fff;
    }

    .hooks { margin-top: 20px; }
    .hook {
      background: #0f0f0f;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 14px;
      border: 1px solid #222;
    }

    .copy {
      margin-top: 10px;
      background: #2a2a2a;
      color: #fff;
    }

    .status {
      margin-top: 10px;
      font-size: 13px;
      opacity: 0.9;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .status.error { color: #ff6b6b; }
    .status.ok { color: #b6ffb6; }
  </style>
</head>
<body>
  <div class="app">
    <h1>TikTok Hook Generator</h1>

    <p class="desc">
      TikTok hooks decide whether people watch or scroll.
      Enter your video topic and get <b>10 high-converting hooks</b>
      designed to grab attention in the first 3 seconds.
    </p>

    <div class="meta">
      <div>Free trial: 2 generations</div>
      <div id="counterText">Remaining: —</div>
    </div>

    <textarea id="topic" placeholder="Enter video topic..."></textarea>
    <button id="genBtn" onclick="generateHooks()">Generate hooks</button>

    <div class="status" id="status"></div>
    <div class="hooks" id="hooks"></div>

    <button class="copy" onclick="copyHooks()">Copy all hooks</button>
    <button class="upgrade" id="upgradeBtn" style="display:none;" onclick="upgrade()">Upgrade (Unlimited)</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js"></script>

  <script>
    const FREE_LIMIT_TOTAL = 2;
    const STORAGE_KEY = "tth_free_total_v1";

    const PRICE_USDC = 9;
    const RECEIVER = "0x3B5Ca729ae7D427616873f5CD0B9418243090c4c";
    const USDC_BASE = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913";
    const BASE_CHAIN_ID = "0x2105";

    function isPro() {
      return localStorage.getItem("pro") === "true";
    }

    function getUsed() {
      return Number(localStorage.getItem(STORAGE_KEY) || 0);
    }

    function setUsed(n) {
      localStorage.setItem(STORAGE_KEY, String(n));
    }

    function remaining() {
      if (isPro()) return { used: 0, rem: Infinity };
      const used = getUsed();
      const rem = Math.max(0, FREE_LIMIT_TOTAL - used);
      return { used, rem };
    }

    function updateCounterUI() {
      const { rem } = remaining();
      document.getElementById("counterText").textContent =
        isPro() ? "PRO: Unlimited" : `Remaining: ${rem}`;
      document.getElementById("upgradeBtn").style.display =
        isPro() ? "none" : rem === 0 ? "block" : "none";
    }

    function renderHooks(hooks) {
      const c = document.getElementById("hooks");
      c.innerHTML = "";
      hooks.forEach(h => {
        const d = document.createElement("div");
        d.className = "hook";
        d.textContent = h;
        c.appendChild(d);
      });
    }

    async function upgrade() {
      if (!window.ethereum) return alert("Install MetaMask");

      try {
        const provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        const signer = await provider.getSigner();

        const network = await provider.getNetwork();
        if (network.chainId !== 8453n) {
          await window.ethereum.request({
            method: "wallet_switchEthereumChain",
            params: [{ chainId: BASE_CHAIN_ID }]
          });
        }

        const usdc = new ethers.Contract(
          USDC_BASE,
          ["function transfer(address to, uint256 amount) public returns (bool)"],
          signer
        );

        const amount = ethers.parseUnits(String(PRICE_USDC), 6);
        const tx = await usdc.transfer(RECEIVER, amount);

        alert("Confirming transaction…");
        await tx.wait();

        localStorage.setItem("pro", "true");
        alert("✅ PRO unlocked!");
        location.reload();

      } catch (e) {
        alert("Payment cancelled or failed");
      }
    }

    async function generateHooks() {
      const topic = document.getElementById("topic").value.trim();
      const status = document.getElementById("status");
      const btn = document.getElementById("genBtn");

      status.textContent = "";
      renderHooks([]);

      if (!topic) return alert("Enter a topic");

      const u = remaining();
      if (!isPro() && u.rem <= 0) {
        updateCounterUI();
        return alert("Free limit reached. Upgrade to continue.");
      }

      btn.disabled = true;
      status.textContent = "Generating…";

      try {
        const r = await fetch("/api/hooks", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ topic })
        });
        const d = await r.json();

        renderHooks(d.hooks || []);
        if (!isPro()) setUsed(getUsed() + 1);
        updateCounterUI();

        status.textContent = "Done.";
      } catch {
        status.textContent = "Error";
      } finally {
        btn.disabled = false;
      }
    }

    async function copyHooks() {
      const hooks = document.querySelectorAll(".hook");
      let text = "";
      hooks.forEach(h => text += h.textContent + "\n");
      await navigator.clipboard.writeText(text);
      alert("Copied");
    }

    updateCounterUI();
  </script>
</body>
</html>
